# survey-processor

This script does some processing of the user insights output from Google Sheets to create a .json file ready to load into MongoDB. 

# Steps

1. Run `gsed` on the user insights export file to remove some commas in field values to make it easier to parse the CSV.
`gsed -e 's/Yes,\sfor\ssure/Yes for sure/g' -e 's/Yes,\sbut/Yes but/g' -e 's/Limited,\snon/Limited non/g' pulse-ui.csv > pulse-ui2.csv`
2. Run `npm run build`.
3. Execute script with signups csv and user insights csv files as inputs:
`node dist/index.js --signups-file ~/Downloads/pulse-ea.csv --insights-file ~/Downloads/pulse-ui2.csv > [FILE WITH TODAYS DATE]`
4. Connect to MongoDB using `mongosh` to delete old data:
```
mongosh "mongodb+srv://cluster0.foobar.mongodb.net/" --apiVersion 1 --username username
use easignups
db.easignups.deleteMany({})
```
5. Use mongoimport to load .json file generated by script:
`mongoimport --uri mongodb+srv://user:password@cluster0.foobar.mongodb.net/easignups --collection easignups --type json --file insights_2023-06-23.json`
6. Import `dashboard.charts` into your Atlas Charts account if you haven't already.
